{% extends "layouts/base.html" %}

{% block title %}
Dashboard
{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
<style>
    td {
        white-space: normal !important;
        word-wrap: break-word;
    }

    table {
        table-layout: fixed;
    }

    .light {
        background-color: #fff479;
        color: black;
    }
</style>
{% endblock %}

{% block content %}
<div class="">
    <div class="pcoded-wrapper row justify-content-center">
        <div class="col-md-11">
            <div class="pcoded-content">
                <div class="pcoded-inner-content">
                    <!-- [ breadcrumb ] start -->

                    <!-- [ breadcrumb ] end -->
                    <div class="main-body">
                        <div class="page-wrapper">
                            <!-- [ Main Content ] start -->
                            <div class="row p-3 justify-content-center">
                                <div class="col-md-6">
                                    <form action="" id="form">
                                        <div class="input-group mb-3">
                                            <input type="text" name="search" class="form-control"
                                                placeholder="Donald J. Trump" aria-label="Recipient's username"
                                                aria-describedby="basic-addon2" minlength="4" value="{{keyword}}" required>
                                            <div class="input-group-append">
                                                <button class="btn btn-primary" type="submit">Search</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="container mt-5">

                                <table id="example" class="table table-striped table-bordered" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>Context</th>
                                            <th>Page</th>
                                            <th>Witness</th>
                                            <th>URL</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        {% for data in results %}
                                        <tr>
                                            <td class="ctx">{{data.0}}</td>
                                            <td>{{data.1}}</td>
                                            <td>{{data.2}}<br/>
                                                <img src="/static/assets/testimony_photos/{{data.2}}.jpg" width="100px" alt="">
                                            </td>
                                            <td>{{data.3}}</td>

                                        </tr>
                                        {% endfor %}

                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>



    </div>
</div>

{% endblock %}

{% block javascripts %}
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script>
    $(document).ready(function () {
        $('#example').DataTable({
            "paging": true,
            "responsive": true,
            "columnDefs": [
                { "width": "50%", "targets": 0 },
                { "width": "5%", "targets": 1 },
                { "width": "15%", "targets": 2 },
                { "width": "30%", "targets": 3 },
            ]
        });
    });
    function highlight(keyword) {
        console.log(keyword)
        var re = new RegExp(keyword, 'gi');
        var rows = document.getElementsByClassName("ctx")
        for (i = 0; i < rows.length; i++) {
            var ele = rows[i];
            var txt = ele.innerHTML;
            var arry = txt.match(re);
            var index = txt.indexOf(arry[0]);
            if (index >= 0) {
                html = txt.substring(0, index) + "<span class='light'>" + txt.substring(index, index + keyword.length) + "</span>" + txt.substring(index + keyword.length);
                ele.innerHTML = html;
            }
        }
    }
    highlight("{{keyword}}");
</script>
{% endblock %}